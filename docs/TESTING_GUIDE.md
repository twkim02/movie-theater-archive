# 🧪 코드 검증 가이드

이 문서는 작성한 코드가 제대로 작동하는지 확인하는 방법을 설명합니다.

## 📋 목차

1. [자동화된 테스트 실행](#1-자동화된-테스트-실행)
2. [시각적 테스트 화면](#2-시각적-테스트-화면)
3. [각 테스트의 의미](#3-각-테스트의-의미)
4. [테스트 결과 해석](#4-테스트-결과-해석)
5. [전체 기능 테스트 가이드](#5-전체-기능-테스트-가이드)

---

## 1. 자동화된 테스트 실행

### 전체 테스트 실행

터미널에서 다음 명령어를 실행하세요:

```bash
flutter test
```

이 명령어는 모든 테스트 파일을 실행하고 결과를 보여줍니다.

### 특정 테스트만 실행

```bash
# Movie 모델 테스트만 실행
flutter test test/models/movie_test.dart

# AppState 테스트만 실행
flutter test test/state/app_state_test.dart

# 더미데이터 테스트만 실행
flutter test test/data/dummy_movies_test.dart
```

### 예상되는 결과

모든 테스트가 통과하면 다음과 같은 메시지가 표시됩니다:

```
00:00 +7: All tests passed!
```

---

## 2. 시각적 테스트 화면

### 테스트 화면 접근 방법

#### 방법 1: RootScreen에 FloatingActionButton 추가 (권장)

`lib/screens/root_screen.dart` 파일에 FloatingActionButton 추가:

```dart
import 'test_screen.dart'; // 추가

// Scaffold에 floatingActionButton 추가
floatingActionButton: FloatingActionButton(
  onPressed: () {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => const TestScreen()),
    );
  },
  tooltip: '코드 검증 테스트',
  child: const Icon(Icons.bug_report),
),
```

#### 방법 2: RootScreen 임시 수정 (개발 중에만)

`lib/screens/root_screen.dart` 파일을 임시로 수정하여 테스트 화면을 첫 번째 탭으로 설정:

```dart
import 'test_screen.dart'; // 추가

// screens 리스트에 추가 (임시로 첫 번째로)
final screens = [
  const TestScreen(),  // 테스트 화면을 첫 번째로 추가
  const ExploreScreen(),
  const DiaryScreen(),
  const SavedScreen(),
  const TasteScreen(),
];
```

#### 방법 3: 네비게이션 바에 테스트 탭 추가 (개발 중에만)

테스트 화면을 5번째 탭으로 추가 (개발 중에만 사용):

```dart
final screens = [
  const ExploreScreen(),
  const DiaryScreen(),
  const SavedScreen(),
  const TasteScreen(),
  const TestScreen(), // 개발 중에만 추가
];

// NavigationBar destinations에도 추가
destinations: const [
  // ... 기존 4개 탭
  NavigationDestination(
    icon: Icon(Icons.bug_report_outlined),
    selectedIcon: Icon(Icons.bug_report),
    label: '테스트',
  ),
],
```

### 테스트 화면 기능

테스트 화면은 **5개의 탭**으로 구성되어 있습니다:

#### 📊 요약 탭
- 전체 기능 통합 테스트 결과 요약
- 영화, 기록, 위시리스트, 통계 데이터 로드 상태 확인

#### 🎬 영화 탭
1. ✅ **Movie 모델 테스트**: JSON 변환, copyWith 등
2. 🔄 **북마크 기능 테스트**: 북마크 추가/제거/토글
3. 📚 **북마크된 영화 목록**: 실제 북마크 상태 확인

#### 📝 기록 탭
1. ✅ **기록 통계**: 전체 기록 수, 평균 별점, 본 영화 수
2. 🔄 **기록 정렬**: 최신순, 별점순, 많이 본 순
3. 🔍 **기록 필터**: 검색어(제목/태그/한줄평) 필터링
4. 📋 **기록 목록**: 필터링 및 정렬된 기록 목록 확인

#### ❤️ 위시리스트 탭
1. ✅ **위시리스트 통계**: 전체/더미/추가된 아이템 수
2. ➕ **위시리스트 추가/제거**: 영화 추가 및 제거 기능
3. 🔄 **위시리스트 정렬**: 날짜순, 제목순, 평점순
4. 📋 **위시리스트 목록**: 현재 위시리스트 아이템 확인

#### 📈 통계 탭
1. ✅ **요약 통계**: 전체 기록 수, 평균 별점, 최다 선호 장르
2. 🎭 **장르 분포**: 전체/최근 1년/최근 3년 장르별 분포
3. 📊 **관람 추이**: 연도별/월별 관람 횟수 추이
4. 🧮 **실제 데이터 계산**: 기록 데이터 기반 통계 계산

---

## 3. 각 테스트의 의미

### Movie 모델 테스트 (`test/models/movie_test.dart`)

#### `fromJson` 테스트
- **목적**: JSON 데이터를 Movie 객체로 변환하는지 확인
- **검증**: 모든 필드가 올바르게 파싱되는지
- **중요성**: API나 더미데이터에서 받은 JSON을 사용할 수 있는지 확인

#### `toJson` 테스트
- **목적**: Movie 객체를 JSON으로 변환하는지 확인
- **검증**: 나중에 로컬 저장이나 API 전송 시 사용 가능한지

#### `Round-trip` 테스트
- **목적**: JSON → Movie → JSON 변환이 손실 없이 되는지 확인
- **검증**: 데이터 일관성 보장

#### `copyWith` 테스트
- **목적**: 불변 객체의 일부 필드만 변경하는 기능 확인
- **검증**: 상태 관리 시 유용한 기능이 작동하는지

### DummyMovies 테스트 (`test/data/dummy_movies_test.dart`)

#### 데이터 로드 테스트
- **목적**: 더미 데이터가 올바르게 로드되는지 확인
- **검증**: 7개의 영화가 모두 로드되는지

#### 필수 필드 검증
- **목적**: 모든 영화의 필수 데이터가 채워져 있는지 확인
- **검증**: UI에서 사용할 때 오류가 발생하지 않는지

#### 특정 영화 존재 확인
- **목적**: 더미데이터 예시.txt에 명시된 영화들이 모두 있는지 확인
- **검증**: 데이터 계약서 준수

### AppState 테스트 (`test/state/app_state_test.dart`)

#### 초기 상태 테스트
- **목적**: 앱 시작 시 올바른 초기 상태인지 확인
- **검증**: 영화 리스트는 있지만 북마크는 비어있어야 함

#### 북마크 기능 테스트
- **목적**: 북마크 추가/제거/토글이 정상 작동하는지 확인
- **검증**: 상태 변경 시 UI 업데이트가 가능한지

#### 불변성 테스트
- **목적**: 내부 상태가 직접 수정되지 않도록 보호되는지 확인
- **검증**: 안전한 상태 관리

### Record 테스트 (`test/models/record_test.dart`, `test/state/app_state_record_test.dart`)

#### Record 모델 테스트
- **목적**: JSON 변환, copyWith, toString 등 모델 기능 확인
- **검증**: API 응답을 올바르게 파싱할 수 있는지

#### 기록 조회 및 정렬 테스트
- **목적**: 기록 리스트 조회, 정렬(최신순/별점순/많이 본 순) 기능 확인
- **검증**: 정렬 옵션이 올바르게 작동하는지

#### 기록 필터 테스트
- **목적**: 기간 필터, 검색어 필터 기능 확인
- **검증**: 필터링이 정확하게 작동하는지

### Wishlist 테스트 (`test/models/wishlist_test.dart`, `test/state/app_state_wishlist_test.dart`)

#### WishlistItem 모델 테스트
- **목적**: JSON 변환, copyWith 등 모델 기능 확인
- **검증**: 위시리스트 데이터 구조가 올바른지

#### 위시리스트 관리 테스트
- **목적**: 추가/제거, 존재 확인 기능 확인
- **검증**: 위시리스트 상태 관리가 정상 작동하는지

#### 위시리스트 정렬 및 필터 테스트
- **목적**: 날짜순/제목순/평점순 정렬, 장르 필터 기능 확인
- **검증**: 다양한 정렬 옵션이 작동하는지

### Statistics 테스트 (`test/models/summary_test.dart`, `test/state/app_state_statistics_test.dart`)

#### Statistics 모델 테스트
- **목적**: 통계 데이터 모델의 JSON 변환 확인
- **검증**: API 응답 구조와 일치하는지

#### 통계 조회 테스트
- **목적**: 요약 통계, 장르 분포, 관람 추이 조회 기능 확인
- **검증**: 모든 통계 데이터가 올바르게 로드되는지

#### 실제 데이터 계산 테스트
- **목적**: 기록 데이터 기반 통계 계산 기능 확인
- **검증**: 실제 데이터로 통계를 생성할 수 있는지

---

## 4. 테스트 결과 해석

### ✅ 모든 테스트 통과

```
00:00 +7: All tests passed!
```

**의미**: 
- 모든 코드가 정상 작동함
- 팀원과 코드를 합쳐도 안전함
- 데이터 구조가 올바르게 구현됨

**다음 단계**: 팀원과 코드 합치기 가능

---

### ❌ 일부 테스트 실패

```
00:00 +5 -2: Some tests failed.
  Failed tests:
  - test/models/movie_test.dart: fromJson 테스트
  - test/state/app_state_test.dart: 북마크 토글 테스트
```

**의미**: 
- 문제가 있는 부분이 있음
- 수정이 필요함

**조치 방법**:
1. 실패한 테스트 이름 확인
2. 에러 메시지 확인
3. 해당 부분의 코드 수정
4. 다시 테스트 실행

---

## 🔍 문제 해결

### 테스트 실행 시 "package not found" 오류

```bash
flutter pub get
```

### 특정 테스트만 계속 실패하는 경우

1. 해당 테스트 파일의 `expect` 부분 확인
2. 실제 데이터와 예상 값 비교
3. 디버깅용 print 문 추가:

```dart
test('문제가 있는 테스트', () {
  final result = someFunction();
  print('실제 결과: $result'); // 디버깅
  expect(result, expectedValue);
});
```

---

## 📝 체크리스트

코드를 팀원과 합치기 전에 확인:

- [ ] `flutter test` 명령어로 모든 테스트 통과
- [ ] 테스트 화면에서 모든 기능이 정상 작동
- [ ] 린터 오류 없음 (`flutter analyze`)
- [ ] 앱이 정상적으로 실행됨 (`flutter run`)
- [ ] 코드 주석과 문서가 명확함

---

## 5. 전체 기능 테스트 가이드

### 테스트 화면에서 확인할 수 있는 모든 기능

#### 🎬 영화 기능
- ✅ Movie 모델 JSON 변환 (`toJson`, `fromJson`)
- ✅ Movie 모델 `copyWith` 메서드
- ✅ 북마크 추가/제거/토글
- ✅ 북마크된 영화 목록 조회

#### 📝 기록 기능
- ✅ 전체 기록 목록 조회
- ✅ 기록 정렬 (최신순, 별점순, 많이 본 순)
- ✅ 기록 검색 필터 (제목, 태그, 한줄평)
- ✅ 기록 통계 (총 기록 수, 평균 별점, 본 영화 수)
- ✅ 특정 영화의 기록 조회

#### ❤️ 위시리스트 기능
- ✅ 위시리스트 목록 조회 (더미 + 추가된 아이템)
- ✅ 위시리스트에 영화 추가
- ✅ 위시리스트에서 영화 제거 (동적으로 추가한 것만)
- ✅ 위시리스트 정렬 (날짜순, 제목순, 평점순)
- ✅ 위시리스트 장르 필터링
- ✅ 위시리스트 통계

#### 📈 통계 기능
- ✅ 요약 통계 (총 기록 수, 평균 별점, 최다 선호 장르)
- ✅ 장르 분포 (전체, 최근 1년, 최근 3년)
- ✅ 관람 추이 (연도별, 월별)
- ✅ 실제 기록 데이터 기반 통계 계산

### 테스트 화면 사용 방법

1. **앱 실행**: `flutter run`으로 앱을 실행합니다
2. **테스트 화면 접근**: 
   - 방법 1: `RootScreen`에서 `TestScreen`으로 네비게이션 추가
   - 방법 2: 임시로 `RootScreen`의 첫 번째 탭을 `TestScreen`으로 설정
3. **각 탭 탐색**: 5개의 탭을 클릭하여 각 기능을 테스트
4. **버튼 클릭**: 각 기능의 버튼을 클릭하여 동작 확인
5. **데이터 확인**: 화면에 표시된 데이터가 예상과 일치하는지 확인

---

## 🚀 최종 확인

모든 테스트를 통과했다면:

1. ✅ **Movie 모델**: JSON 변환, copyWith 등 모든 기능 작동
2. ✅ **DummyMovies**: 7개 영화 데이터 정상 로드
3. ✅ **AppState**: 북마크 기능, 상태 관리 정상 작동
4. ✅ **Provider 연결**: 앱 전반에서 상태 접근 가능
5. ✅ **Record 기능**: 기록 조회, 정렬, 필터링 정상 작동
6. ✅ **Wishlist 기능**: 위시리스트 추가/제거/정렬 정상 작동
7. ✅ **Statistics 기능**: 통계 조회 및 계산 정상 작동

**이제 팀원과 안심하고 코드를 합칠 수 있습니다!** 🎉

---

## 📊 테스트 커버리지 요약

| 기능 영역 | 모델 테스트 | 데이터 테스트 | 상태 관리 테스트 | 시각적 테스트 |
|----------|-----------|------------|--------------|------------|
| 영화 (Movie) | ✅ 5개 | ✅ 4개 | ✅ 7개 | ✅ 완료 |
| 기록 (Record) | ✅ 7개 | ✅ 8개 | ✅ 19개 | ✅ 완료 |
| 위시리스트 (Wishlist) | ✅ 8개 | ✅ 7개 | ✅ 19개 | ✅ 완료 |
| 통계 (Statistics) | ✅ 14개 | ✅ 9개 | ✅ 20개 | ✅ 완료 |
| **전체** | **34개** | **28개** | **65개** | **✅ 완료** |

---

## 📌 참고사항

- 테스트 화면(`test_screen.dart`)은 개발 중에만 사용
- 최종 제출 전이나 팀원과 합칠 때는 제거 가능
- 테스트 파일(`test/` 폴더)은 그대로 유지 (CI/CD에서 사용 가능)
